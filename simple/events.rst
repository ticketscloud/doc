.. _simple/events:

======================
Работа с мероприятиями
======================

В этом разделе описывается упрощённая, но достаточная в большенстве случаев интеграции,
модель работы с мероприятиями.


.. _simple/events/simple:

/v1/services/simple/events
==========================

Запрос ``GET /v1/services/simple/events`` позволяет простым способом
всю необходимую получить информацию по всем мероприятиям, доступным
для продажи :ref:`авторизированному <basic/auth>` партнёру.

:ref:`Пример запроса <ex/simple-events>`.

Основные поля
-------------

:id: id мероприятия
:created_at: дата создания
:updated_at: дата последнего изменения
:lifetime: :ref:`vevent <simple/events/vevent>`, время проведения мероприятия
:status: текущий статус мероприятия
    (``public`` — публичное мероприятие, можно продавать билеты)

:title:

    :text: название мероприятия
    :desc: описание мероприятия

:media: :ref:`media <simple/events/media>` логитипы в различных размерах:

    :cover_original:
    :cover:
    :cover_small:

:org: информация об организаторе мероприятия

    :id: id организатора
    :name: название организатора
    :desc: краткое описание
    :media: логитипы (:ref:`media <simple/events/media>`)
    :contact: контактная информация

:venue: место проведения

    :id:
    :address: адрес
    :country: :ref:`страна <country>`
    :city: :ref:`город <city>`
    :name: название
    :desc: краткое описание
    :point: координата (`GeoJSON <http://geojson.org>`_'s point)

:map: схема зала

    :id:

:sets: билетные категории

    :id:
    :pos: int, порядковый номер категории (для сортировки)
    :name: название категории
    :amount: общее количество билетов в сете
    :amount_vacant: количество билетов, доступных для продажи
    :price_org: номинальная цена билета
    :price_extra: сервисный сбор
    :price: общая цена билета
    :with_seats: наличие посадочных мест в категории
    :seats: :ref:`места <simple/events/seats>`
    :sector: сектор

    :rules: правила

        :id:
        :cal: :ref:`vevent <simple/events/vevent>`, время действия правила
        :current: ``true``, если правило текущее
        :price_org: номинальная цена
        :price_extra: сервисный сбор
        :price: конечная цена


:partner: устаревшее поле, будет удалено в будущем


Фильтры
-------

Фильтры добавляются в виде параметров URL.

:org: id организатора;
:venue: id площадки;
:country: страна;
:city: город;
:lifetime__range: фильтр по времени проведения мероприятия, указывается двумя ISO-датами через запяту;
:price__range: фильтр по стоимости, указывается двумя числами, через запятую;

.. EXAMPLE
.. Нужны примеры фильтрации по org, lifetime__range и price__range

Паджинация
----------

:page_size: количество мероприятий на странице;
:page: номер страницы;

.. EXAMPLE

Сортировка
----------

Сортировка производится указанием параметра ``sort`` с соответтвующим значением.
Каждое значение может начинаться с символа ``-`` для изменения порядка сортировки.

Может быть указано несколько элементов сортировки одновременно, через запятую::

    GET /v1/services/simple/events?sort=-price,start

:start:
:end:
:price:

.. EXAMPLE
.. Пример сортировки по цене


/v1/resources/events/:id/tickets
================================

Получение списка билетов мероприятия, для категорий с рассадкой.

Поля
----

:id: id билета
:status: одно из ``vacant``, ``reserved`` или ``sold``
:set: билетная категория
:reserved_till: если статус ``reserved``, то это время окончания конца резервирования
:seat: Информация о месте проведения

    :row: ряд
    :number: место
    :sector: сектор карты

:ref:`Пример запроса <ex/tickets>`.

Фильтры
-------

Фильтры добавляются в виде параметров URL.

:status: статус билета или список статусов через запятую;


.. _simple/events/vevent:

VEVENT
======

Поле типа vevent, это строка в формате ``VEVENT`` из :rfc:`2445`.
В настоящий момент поддерживается только два значения: ``DTSTART`` и ``DTEND``. Значения указываются только в `UTC <https://goo.gl/QGpQCU>`_

Пример::

    BEGIN:VEVENT\r\n
    DTSTART;VALUE=DATE-TIME:20160124T160000Z\r\n
    DTEND;VALUE=DATE-TIME:20160124T173000Z\r\n
    END:VEVENT\r\n


.. _simple/events/media:

Media
=====

Различные медиа-данные имеют общий формат.

:id:
:author: id создателя
:content_type: тип файла (например, "image/jpeg")
:length: размер в байтах
:md5hash: хеш md5 от содержимого
:url: полный урл до файла


.. _simple/events/seats:

Места
=====
