.. _simple/ps:

=================
Платёжные системы
=================

.. _simple/ps/api:

api/BASE
========

:term:`Платёжная система` `api/BASE` используется для проведения заказа по api.
В этом случае деньги за заказ каким-либо образом берёт сам продавец.

* :ref:`Пример работы с заказом без платрона <ex/orders/manual>`

.. _simple/ps/platron:

Platron
=======

Если вы хотите, чтобы покупатели оплачивал заказ через платрон, нужно выбрать
платёжную систему из :ref:`списка ниже <simple/ps/platron/list>`.

Алгоритм использования платрона такой:

    * :ref:`создать заказ <simple/orders/create>` и :ref:`добавить билеты <simple/orders/reserve>`;
    * :ref:`Установить имя, фамилию и email в поле customer  ь<simple/orders/customer>`
    * :ref:`установить платёжную систему <simple/orders/ps>` из :ref:`списка ниже <simple/ps/platron/list>`;
    * установить поля ``payment.success_url`` и ``payment.failure_url``;
    * :ref:`перевести заказ <simple/orders/change_status>` в :ref:`in_progress`;
    * перенаправить пользователя на ``payment.redirect_url``;

После чего покупатель оплачивает заказ на сайте платрона и перенаправляется
на ``success_url`` или ``failure_url``, а заказ переходит в
:ref:`done` (в случае успеха), :ref:`canceled` (в случае отмены) или :ref:`expired` (в случае неоплаты).

* :ref:`Пример работы с платроном <ex/orders/platron>`.

.. _simple/ps/platron/list:

Список платёжных систем платрона
--------------------------------

:platron/OTHER: универсальная, способ оплаты покупатель выбирает на сайте платрона;
:platron/RUSSIANSTANDARD: банковские карты;
:platron/CASH: наличные ("евросеть", "связной"...);
:platron/YANDEXMONEY: яндекс деньги;
:platron/ALFACLICK: альфа-клик;

Тестовые платежные системы
~~~~~~~~~~~~~~~~~~~~~~~~~~

Тестовые платежные системы доступны только на https://stage.ticketscloud.org .

:platron/TEST: для проверки полного цикла оплаты;
:platron/TEST_WITHOUT_PLATRON: для проверки цикла оплаты исключая платрон


.. _simple/ps/invoices:

Выставление счёта
=================

Для того, чтобы сформировать счёт, нужно установить платёжную систему ``system/INVOICE``
и передать необходимые, для выставления счёта, параметры.
Параметры передаются значением ``payment.settings``.

:url: url информации о мероприятии;
:type: форма собственности организации:

    :ru/ltd: ООО;
    :ru/ip: ИП;

:name: наименование платильщика;
:address: юридический адрес;
:orgn: ОГРН (необязательно для ИП);
:inn: ИНН;
:kpp: КПП;
:rs: рассчётный счёт;
:bank: название банка;
:bik: БИК;
:ks: корреспондентский счёт;

После перевода такого заказа в :ref:`in_progress`, покупател будет выслан стандартный
договор-счёт для оплаты.

После получения денег, покупателю автоматически будут высланы билеты и акты об оказании услуг.

.. EXAMPLE
.. Нужен пример создания заказа с выставлением счёта
.. Лучше в два действия: добавляем билеты, а потом, одним запросом, выставляем ПС и переводим в in_progress
